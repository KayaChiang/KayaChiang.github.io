<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <title>iPad Air Filter</title>
    <style>
        .container {
            padding: 50px 0;
        }

        .total_price p {
            font-size: 30px;
            font-weight: bold;
            padding-top: 30px;
        }

    </style>
</head>

<body>

    <div class="container">

        <div class="row">
            <div class="col-12 col-md-6">
                <img class="product_img" src="Apple_img/iPad/ipad-2020-hero-space-wifi-select.png"
                    style="padding: 20px 0; width: 80%; display: block; margin: 0 auto;">

                <div class="service" style="display: flex; padding: 30px 20px; justify-content: space-around; ">

                    <div>
                        <img src="Apple_img/service.svg" style="display: block; margin: 0 auto;">
                        <span style="display: block; font-size: 10px; padding: 5px;">快速且免額外付費的運送服務</span>
                    </div>
                    <div>
                        <img src="Apple_img/customize.svg" style="display: block; margin: 0 auto;">
                        <span style="display: block; font-size: 10px; padding: 5px;">免額外付費的個人化鐫刻服務</span>
                    </div>
                    <div>
                        <img src="Apple_img/return.svg" style="display: block; margin: 0 auto;">
                        <span style="display: block; font-size: 10px; padding: 5px;">免額外付費輕鬆退貨</span>
                    </div>
                </div>
            </div>

            <div class="col-12 col-md-6 ">

                    <div class="accordion" id="accordionExample">
                        <div class="card">
                            <div class="card-header" id="headingOne">
                                <h2 class="mb-0"
                                    style="display: flex; font-size: 20px; justify-content: space-between;">
                                    <span class="color_title" style="display: flex; align-items: center;">外觀</span>
                                    <button class="btn btn-link btn-block text-left change" type="button"
                                        data-toggle="collapse" data-target="#collapseOne" aria-expanded="true"
                                        aria-controls="collapseOne"
                                        style="display: inline-block; width: 60px; font-size: 15px;">
                                        更改
                                    </button>
                                </h2>
                            </div>
                            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne"
                                >
                                <div class="card-body-color" style="padding: 10px;">

                                    <template id="color-btn">
                                            <button class="col-6 col-md-4 btn-outline-secondary m-2 _color"
                                                style="background-color: #fff; padding: 10px; width: 40%; border-radius: 10px; color:#A3A3A4" data-target="#collapseOne" data-toggle="collapse" >
                                                <img src="Apple_img/iPad/finish-spacegray-201903.png"
                                                    style="width: 25%;">
                                                <h3 style="font-size: 12px; padding: 5px 0 0 ;">太空灰色</h3>
                                            </button>
                                    </template>

                                </div>
                            </div>
                    </div>


                        <div class="accordion" id="accordionExample">
                            <div class="card">
                                <div class="card-header" id="headingTwo">
                                    <h2 class="mb-0"
                                        style="display: flex; font-size: 20px; justify-content: space-between;">
                                        <span class="spec_title" style="display: flex; align-items: center;">儲存裝置</span>
                                        <button class="btn btn-link btn-block text-left change" type="button"
                                            data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true"
                                            aria-controls="collapseOne"
                                            style="display: inline-block; width: 60px; font-size: 15px;">
                                            更改
                                        </button>
                                    </h2>
                                </div>

                                <div id="collapseTwo" class="collapse show" aria-labelledby="headingOne">
                                    <div class="card-body-spec" style="padding: 10px;">

                                        <template id="spec_btn">
                                                <button class="col-6 col-md-4 btn-outline-secondary m-2"
                                                    style="background-color: #fff; padding: 10px; width: 40%; border-radius: 10px; color:#A3A3A4" data-target="#collapseTwo" data-toggle="collapse">
                                                    <h3 style="font-size: 20px; padding: 5px 0 0 ;font-weight: bold; color:black;">
                                                        32GB
                                                    </h3>
                                                    <h4 style="font-size: 13px;">NT$10,500起</h4>
                                                </button>
                                        </template>

                                    </div>
                                </div>
                            </div>


                            <div class="accordion" id="accordionExample">
                                <div class="card">
                                    <div class="card-header" id="headingThree">
                                        <h2 class="mb-0"
                                            style="display: flex; font-size: 20px; justify-content: space-between;">
                                            <span class="net_title"
                                                style="display: flex; align-items: center;">連線能力</span>
                                            <button class="btn btn-link btn-block text-left change" type="button"
                                                data-toggle="collapse" data-target="#collapseThree" aria-expanded="true"
                                                aria-controls="collapseOne"
                                                style="display: inline-block; width: 60px; font-size: 15px;">
                                                更改
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapseThree" class="collapse show" aria-labelledby="headingOne">
                                        <div class="card-body-net" style="padding: 10px;">
                                            <template id="net_btn">
                                                    <button class="col-6 col-md-4 btn-outline-secondary m-2"
                                                        style="background-color: #fff; padding: 10px; width: 40%; border-radius: 10px; color:#A3A3A4" data-target="#collapseThree" data-toggle="collapse">
                                                        <h3                                         style="font-size: 18px; padding: 5px 0 0 ; font-weight: bold; color:black;">
                                                            Wi-Fi
                                                        </h3>
                                                        <h4 style="font-size: 13px;">NT$10,500起</h4>
                                                    </button>
                                            </template>
                                        </div>
                                    </div>
                                </div>

                            <div class="total_price">
                                <p>NT$10,500</p>
                            </div>
                        </div>
                    </div>
                </div>


                <script>
                    let current_size = '';
                    let current_net = '';

                    //iPad的JSON資料
                    const url = 'https://raw.githubusercontent.com/KayaChiang/KayaChiang.github.io/main/JS_homework/Apple_filter.json';

                    let ipad_data;
                    window.onload = requestIpadJson();

                    function requestIpadJson() {
                        let xhr = new XMLHttpRequest();
                        xhr.onload = function () {
                            //console.log(this.responseText);
                            ipad_data = JSON.parse(this.responseText); //JSON.parse轉成陣列
                            console.log(ipad_data);
                            create_color();
                            create_spec();
                            create_net();
                        }
                        xhr.open('Get', url);
                        xhr.send();
                    }

                    function create_color() {
                        //商品顏色資料
                        let products = ipad_data.map(x => {
                            return {
                                url_color: x.color_img,
                                url_product: x.product_Url,
                                color: x.color
                            }
                        });

                        //去除重複資料
                        products = products.filter(function (element, index) {
                            return products.findIndex(x => x.color == element.color) == index;
                        })
                        console.log(products);

                        let color_title = document.querySelector('.color_title'); //外觀
                        let product_img = document.querySelector('.product_img'); //大圖
                        let sample_color_btn = document.getElementById('color-btn');
                        let color_area = document.querySelector('.card-body-color');

                        products.forEach(function (item) {
                            let colorTemp = sample_color_btn.content.cloneNode(true);
                            colorTemp.querySelector('h3').innerText = item.color;
                            colorTemp.querySelector('img').src = item.url_color;

                            colorTemp.querySelector('button').onclick = function () {
                                product_img.setAttribute('src', item.url_product);
                                color_title.innerText = item.color;
                            }
                            color_area.append(colorTemp);
                        })
                    }

                    function create_spec() {
                        let products = ipad_data.map(x => {
                            return {
                                size: x.size,
                                price: x.price,
                            }
                        });

                        //去除重複確認
                        products = products.filter(function (element, index) {
                            return products.findIndex(x => x.size == element.size) == index;
                        })
                        console.log(products);

                        let spec_btn = document.getElementById('spec_btn');
                        let card_body_spec = document.querySelector('.card-body-spec');
                        let spec_title = document.querySelector('.spec_title');

                        products.forEach(function (item) {
                            let spec_temp = spec_btn.content.cloneNode(true);
                            spec_temp.querySelector('h3').innerText = item.size;
                            spec_temp.querySelector('h4').innerText = item.price;

                            //算錢+變更title
                            spec_temp.querySelector('button').onclick = function () {
                                console.log(item.price);
                                spec_title.innerText = item.size;
                                current_size = item.size;
                                get_price();
                            }
                            card_body_spec.append(spec_temp);
                        })
                    }

                    function create_net() {

                        let products = ipad_data.map(x => {
                            return {
                                network: x.network,
                                price: x.price,
                            }
                        });

                        products = products.filter(function (element, index) {
                            return products.findIndex(x => x.network == element.network) == index;
                        })
                        console.log(products);

                        let net_btn = document.getElementById('net_btn');
                        let card_body_net = document.querySelector('.card-body-net');
                        let net_title = document.querySelector('.net_title');

                        products.forEach(function (item) {
                            let net_temp = net_btn.content.cloneNode(true);
                            net_temp.querySelector('h3').innerText = item.network;
                            net_temp.querySelector('h4').innerText = item.price;

                            net_temp.querySelector('button').onclick = function () {
                                console.log(item.price);
                                net_title.innerText = item.network;
                                current_net = item.network;
                                get_price();
                            }
                            card_body_net.append(net_temp);
                        })
                    }

                    function get_price() {
                        if (current_net == '' || current_size == '') {
                            return;
                        }
                        let p = ipad_data.find(x => x.network == current_net && x.size == current_size).price;
                        console.log(p);

                        let total_price = document.querySelector('.total_price > p');
                        total_price.innerText = p;
                        console.log(total_price);
                    }
                </script>

                <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
                    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
                    crossorigin="anonymous"></script>
                <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
                    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
                    crossorigin="anonymous"></script>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
                    integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF"
                    crossorigin="anonymous"></script>
</body>

</html>